# Generated by Django 2.2.10 on 2020-05-21 15:09

from django.db import migrations


def create_staff_groups(apps, schema_editor):

    Group = apps.get_model("auth", "Group")
    Permission = apps.get_model("auth", "Permission")

    # Create groups
    data_admin = Group.objects.create(name="DataAdmin")
    profile_admin = Group.objects.create(name="ProfileAdmin")

    # Perms to be assigned
    data_admin_perm_models = {
        "datasets": [
            "datasetfile", "dataset", "indicator", "indicatordata", "universe",
        ]
    }
    profile_admin_perm_models = {
        "points": [
            "profilecategory", "location", "theme", "category",
        ],
        "profile": [
            "indicatorcategory", "indicatorsubcategory", "coordinatefile",
            "logo", "profilehighlight", "profilekeymetrics", "profileindicator"
        ]
    }

    # Assign perms to groups
    for app_label, models in data_admin_perm_models.items():
        permissions = Permission.objects.filter(
            content_type__app_label=app_label, content_type__model__in=models
        ).values_list("id", flat=True)
        data_admin.permissions.add(*permissions)

    for app_label, models in profile_admin_perm_models.items():
        permissions = Permission.objects.filter(
            content_type__app_label=app_label, content_type__model__in=models
        ).values_list("id", flat=True)
        profile_admin.permissions.add(*permissions)


class Migration(migrations.Migration):

    dependencies = [
        ('datasets', '0093_auto_20200520_2031'),
    ]

    operations = [
        migrations.RunPython(create_staff_groups),
    ]
